{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://oma3.org/schemas/endorsement-v1.1.0.schema.json",
  "title": "Endorsement",
  "description": "A lightweight attestation indicating support, trust, or approval for a DID-identified subject. The 'attestationType' field may be used to distinguish informal endorsements from formal approvals.",
  "$comment": "Implements OMA3 pattern: OnchainAttestation. See https://oma3.org/docs/schema-patterns#onchainattestation",
  "type": "object",
  "keywords": [
    "endorsement",
    "approval",
    "reputation",
    "trust",
    "organization",
    "attestation"
  ],
  "required": [
    "attester",
    "subject"
  ],
  "properties": {
    "@context": {
      "type": "string",
      "description": "Optional JSON-LD context URI for semantic processing.",
      "default": "https://oma3.org/context.jsonld",
      "x-oma3-skip-reason": "metadata"
    },
    "@type": {
      "type": "string",
      "description": "Semantic type identifier, typically 'Endorsement'.",
      "default": "Endorsement",
      "x-oma3-skip-reason": "metadata"
    },
    "attester": {
      "type": "string",
      "title": "Attester ID",
      "description": "DID or address of the entity issuing the endorsement or approval.",
      "x-oma3-skip-reason": "bas"
    },
    "subject": {
      "type": "string",
      "title": "Subject ID",
      "description": "DID of the entity being endorsed or approved."
    },
    "subjectDidHash": {
      "type": "string",
      "title": "Subject DID Hash",
      "description": "Keccak256 hash of the canonicalized subject DID, encoded as 0x-prefixed hex string (32 bytes).",
      "pattern": "^0x[a-fA-F0-9]{64}$",
      "x-oma3-skip-reason": "computed"
    },
    "purpose": {
      "title": "Purpose",
      "description": "Optional short string indicating the reason or context of the endorsement or approval. For Approval attestations, this is a structured object; for Endorsements, this is free text."
    },
    "version": {
      "type": "string",
      "title": "Subject Version",
      "description": "Optional semantic version of the subject being endorsed."
    },
    "attestationType": {
      "type": "string",
      "title": "Attestation Type",
      "description": "Distinguishes attestation purpose. Use 'Endorsement' for informal support or 'Approval' for formal recognition."
    },
    "policyURI": {
      "type": "string",
      "format": "uri",
      "title": "Policy URI",
      "description": "Optional URI pointing to the criteria or process used for formal approvals."
    },
    "effectiveAt": {
      "type": "integer",
      "title": "Effective Date",
      "description": "Optional Unix timestamp when the endorsement or approval becomes effective."
    },
    "expiresAt": {
      "type": "integer",
      "title": "Expiration Date",
      "description": "Optional Unix timestamp after which the endorsement or approval expires."
    },
    "issuedAt": {
      "type": "integer",
      "title": "Issued Date",
      "description": "Optional Unix timestamp for when the attestation was issued."
    }
  },
  "additionalProperties": false,
  "allOf": [
    {
      "if": {
        "properties": {
          "attestationType": {
            "const": "Approval"
          }
        },
        "required": [
          "attestationType"
        ]
      },
      "then": {
        "properties": {
          "purpose": {
            "type": "object",
            "properties": {
              "type": {
                "type": "string"
              },
              "extensions": {
                "type": "object",
                "additionalProperties": true
              }
            },
            "required": [
              "type"
            ],
            "additionalProperties": true
          }
        }
      },
      "else": {
        "properties": {
          "purpose": {
            "type": "string"
          }
        }
      }
    }
  ]
}